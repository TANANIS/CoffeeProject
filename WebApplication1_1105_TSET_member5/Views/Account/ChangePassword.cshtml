@model WebApplication1_1105_TSET_member5.Models.Customer

@{
	ViewData["Title"] = "Password";
}

<style>
	.squre1 {
		width: 70%;
		background-color: antiquewhite;
	}
</style>

<h1>修改密碼</h1>
<hr />
<div class="flexQQ">
	<div>@await Html.PartialAsync("_PartialItem")</div>
	<div class="squre1">
		<div class="row">
			<div class="col-md-4">
				<form id="changePasswordForm" asp-action="ChangePassword" method="post">
					@Html.HiddenFor(m => m.CustomerId)
					<div asp-validation-summary="ModelOnly" class="text-danger"></div>

					<!-- 新增 NewPassword 欄位 -->
					<div class="form-group">
						<label for="newPassword" class="control-label">新密碼輸入</label>
						<input type="password" name="newPassword" class="form-control" id="newPassword" required
								placeholder="密碼必須包含大小寫、數字"
								pattern="^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)[A-Za-z\d]{8,}$" />
						<span class="text-danger" id="newPasswordError"></span>
					</div>

					<!-- 新增 ConfirmPassword 欄位 -->
					<div class="form-group">
						<label for="confirmPassword" class="control-label">新密碼確認</label>
						<input type="password" name="confirmPassword" class="form-control" id="confirmPassword" required />
						<span class="text-danger" id="confirmPasswordError"></span>
					</div>
					<div class="form-group">
						<input type="submit" value="Save" class="btn btn-primary" />
						@if (TempData["SaveSuccess"] != null)
						{
							<span class="text-success ml-3">儲存完成!</span>
						}
					</div>
				</form>
			</div>
		</div>
		<div>
			<a asp-action="Index">返回訂單查詢</a>
		</div>
	</div>
</div>

@section Scripts {
	@{
		await Html.RenderPartialAsync("_ValidationScriptsPartial");
	}
	<script>
		document.getElementById('changePasswordForm').addEventListener('submit', function (event) {
			// 清除之前的錯誤信息
			let isValid = true;
			document.getElementById('newPasswordError').textContent = '';
			document.getElementById('confirmPasswordError').textContent = '';


			// 新密碼與確認密碼是否一致
			const newPassword = document.getElementById('newPassword').value;
			const confirmPassword = document.getElementById('confirmPassword').value;
			if (newPassword !== confirmPassword) {
				document.getElementById('confirmPasswordError').textContent = "新密碼與確認密碼不一致";
				isValid = false;
			}

			// 密碼格式驗證：新密碼必須包含大寫字母、小寫字母和數字
			const passwordRegex = /^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)[A-Za-z\d]{8,}$/;
			if (!passwordRegex.test(newPassword)) {
				document.getElementById('newPasswordError').textContent = "新密碼必須包含大寫字母、小寫字母和數字";
				isValid = false;
			}

			// 如果有錯誤則阻止表單提交
			if (!isValid) {
				event.preventDefault();
			}
		});
	</script>
}
